//TODO: should also compare it against some library

#include "../encoding.h"
#include "../decoding.h"
#include "utils/utils.hpp"
#include <utility>

using std::cout;
using std::cerr;
using std::pair;

int main(){
    using namespace CBZ::Utils;

    vector<pair<string,vector<uint8_t>>> test_values = {
        {"1.2.840.113549.1.1.1", {0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01}},
        {"1.2.840.10045.2.1", {0x06, 0x07, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x02, 0x01}},
        {"1.2.840.10045.3.1.7", {0x06, 0x08, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x03, 0x01, 0x07}},
        {"1.3.14.3.2.26", {0x06, 0x05, 0x2b, 0x0e, 0x03, 0x02, 0x1a}},
        {"2.5.4.3", {0x06, 0x03, 0x55, 0x04, 0x03}},
        {"2.5.4.6", {0x06, 0x03, 0x55, 0x04, 0x06}},
        {"2.5.4.7", {0x06, 0x03, 0x55, 0x04, 0x07}},
        {"2.5.4.8", {0x06, 0x03, 0x55, 0x04, 0x08}},
        {"2.5.4.10", {0x06, 0x03, 0x55, 0x04, 0x0a}},
        {"2.5.4.11", {0x06, 0x03, 0x55, 0x04, 0x0b}},
        {"1.2.840.113549.1.1.5", {0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x05}},
        {"1.2.840.113549.1.1.11", {0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b}},
        {"1.2.840.113549.1.1.12", {0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0c}},
        {"1.2.840.113549.1.1.13", {0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0d}},
        {"1.2.840.113549.1.9.1", {0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09, 0x01}},
        {"2.5.29.14", {0x06, 0x03, 0x55, 0x1d, 0x0e}},
        {"2.5.29.15", {0x06, 0x03, 0x55, 0x1d, 0x0f}},
        {"2.5.29.17", {0x06, 0x03, 0x55, 0x1d, 0x11}},
        {"2.5.29.19", {0x06, 0x03, 0x55, 0x1d, 0x13}},
        {"2.5.29.31", {0x06, 0x03, 0x55, 0x1d, 0x1f}},
        {"2.5.29.32", {0x06, 0x03, 0x55, 0x1d, 0x20}},
        {"2.5.29.37", {0x06, 0x03, 0x55, 0x1d, 0x25}},
        {"1.3.6.1.5.5.7.3.1", {0x06, 0x08, 0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x03, 0x01}},
        {"1.3.6.1.5.5.7.3.2", {0x06, 0x08, 0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x03, 0x02}},
        {"1.3.6.1.5.5.7.3.3", {0x06, 0x08, 0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x03, 0x03}},
        {"1.3.6.1.5.5.7.3.4", {0x06, 0x08, 0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x03, 0x04}},
        {"1.3.6.1.5.5.7.1.1", {0x06, 0x08, 0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x01, 0x01}},
        {"1.3.6.1.5.5.7.48.1", {0x06, 0x08, 0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x30, 0x01}},
        {"1.3.6.1.5.5.7.48.2", {0x06, 0x08, 0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x30, 0x02}},
        {"1.3.6.1.4.1.11129.2.4.2", {0x06, 0x0a, 0x2b, 0x06, 0x01, 0x04, 0x01, 0xd6, 0x79, 0x02, 0x04, 0x02}},
        {"1.2.840.10040.4.1", {0x06, 0x07, 0x2a, 0x86, 0x48, 0xce, 0x38, 0x04, 0x01}},
        {"1.3.132.0.10", {0x06, 0x05, 0x2b, 0x81, 0x04, 0x00, 0x0a}},
        {"1.3.132.0.34", {0x06, 0x05, 0x2b, 0x81, 0x04, 0x00, 0x22}}
    };


    for (const auto &[value, check]: test_values) {
        size_t offset = 0;

        cout << "----------------------------------------" << endl;
        cout << "Testing " << value << endl << endl;
        vector<uint8_t> der = encode_der_oid(value);
        if(der != check){
            cerr << "游린 Encoding mismatch detected" << endl;
            cerr << "Encoded value: ";
            print_bytes(der);
            cerr << "Expected value: ";
            print_bytes(check);
        } else {
            cout << "游릴 Encoding check passed" << endl;
        }

        cout << endl;

        string decoded = decode_der_oid(der, offset);
        if (value != decoded){
            cerr << "游린 Decoding mismatch detected";
            cerr << "Decoded value: " << decoded << endl;
        } else {
            cout << "游릴 Decoding check Passed" << endl;
        }

        cout << "----------------------------------------" << endl << endl;;
    }
    return 0;
}
